@import "tailwindcss";

/* ============================================
   Flum — Neon Pop × Blue River テーマ
   背景=川（青）、コンテンツ=流れる情報（ネオンポップ）
   ============================================ */

/* --- 共通アクセント（テーマ問わず固定） --- */
:root {
  --accent-pink: #ff3b9a;
  --accent-pink-light: #ff6bc1;
  --accent-purple: #a855f7;
  --accent-yellow: #ffdd00;
  --accent-cyan: #00e5ff;

  /* 鮮度ステージ（アクセント依存、テーマ問わず固定） */
  --fresh-color: #ff3b9a;
  --fresh-glow: 0 0 10px #ff3b9a, 0 0 4px #ff3b9a;
  --recent-color: #ff6bc1;
  --recent-glow: 0 0 6px rgba(255, 107, 193, 0.5);
  --aging-color: #ffdd00;
  --aging-glow: 0 0 6px rgba(255, 221, 0, 0.4);

  /* ── Float System Tokens ── */

  /* グロー強度（シアン反射光） */
  --glow-cyan-subtle: rgba(0, 229, 255, 0.08);
  --glow-cyan-soft:   rgba(0, 229, 255, 0.12);
  --glow-cyan-medium: rgba(0, 229, 255, 0.18);

  /* リフト量（ホバー時の浮き上がり） */
  --lift-sm: -2px;    /* ボタン・アイコン */
  --lift-md: -3px;    /* カード */
  --scale-sm: 1.08;   /* ボタン・アイコン */
  --scale-md: 1.01;   /* カード */

  /* タイミング */
  --ease-float: 0.2s ease-out;       /* 浮遊トランジション */
  --ease-decay-slow: 1.2s ease-out;  /* ドレイン（色が失われる） */
  --ease-decay-fast: 0.08s ease-out; /* カラーフラッシュ（色が戻る） */
  --spring: cubic-bezier(0.34, 1.56, 0.64, 1); /* バウンスカーブ */

  /* ネオブルータリスト影（オフセット + シアン） */
  --neo-sm: 2px 2px 0 var(--accent-cyan);
  --neo-md: 3px 3px 0 var(--accent-cyan);
  --neo-lg: 4px 4px 0 var(--accent-cyan);

  /* 水面ボブ振幅 */
  --float-amplitude: 3px;
}

/* --- Dark: ネオンポップの舞台（近黒 + ビビッドアクセント） --- */
:root,
[data-theme="dark"] {
  --river-deep: #0a0a10;
  --river-bg: #101018;
  --river-surface: #18182a;
  --river-border: #2a2a40;

  --text-primary: #e8e8f0;
  --text-secondary: #8888a8;
  --text-muted: #606078;
  --text-faded: #404058;

  --old-color: #1e3a58;
  --stale-color: #0f1f38;

  --glass-bg: rgba(0, 0, 0, 0.95);
  --glass-overlay: rgba(0, 0, 0, 0.50);

  --background: var(--river-bg);
  --foreground: var(--text-primary);
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);

  /* Tailwind カスタムカラー */
  --color-river-deep: var(--river-deep);
  --color-river-bg: var(--river-bg);
  --color-river-surface: var(--river-surface);
  --color-river-border: var(--river-border);
  --color-neon-pink: var(--accent-pink);
  --color-neon-pink-light: var(--accent-pink-light);
  --color-neon-purple: var(--accent-purple);
  --color-neon-yellow: var(--accent-yellow);
  --color-neon-cyan: var(--accent-cyan);

  /* インタラクショントークン */
  --color-int-accent: var(--accent-cyan);   /* Secondary/bordered ホバーアクセント */
  --color-int-danger: #f87171;               /* Destructive ホバー */

  /* ネオブルータリスト影 */
  --shadow-neo-sm: 2px 2px 0 var(--accent-cyan);
  --shadow-neo-md: 3px 3px 0 var(--accent-cyan);
  --shadow-neo-lg: 4px 4px 0 var(--accent-cyan);

  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}


/* --- カラードレイン ---
   Splatoon: 彩度剥奪 = 弱体化
   Persona 5: 彩度 + 色温度シフト = 状態変化
   非対称トランジション: ゆっくり色を失い、瞬時に復活（カラーフラッシュ）

   重要: transition は card-float と統合管理（CSS の transition はマージされないため）
   decay 単体の transition はここに書かない → .card-float セクションで一括定義 */

[data-decay="true"] {
  opacity: var(--decay-opacity, 1);
  /* transition は .card-float / .card-float[data-decay] で統合管理 */
}

/* ホバー / タップ: 瞬時復帰 = Splatoon の「色が戻る」快感 */
[data-decay="true"]:hover,
[data-decay="true"]:active {
  filter: none !important;
  opacity: 1 !important;
  /* transition は .card-float[data-decay]:hover で統合管理 */
}

/* モバイル: ホバーなし端末では filter 無効・opacity のみで鮮度表現 */
@media (hover: none) {
  [data-decay="true"] {
    filter: none !important;
    opacity: max(var(--decay-opacity, 1), 0.6);
  }
}

/* --- フィードカード入場アニメーション ---
   日本アニメ式「ポンッ」: 浮上 → オーバーシュート → 着地 + ソフトグロー
   参考: ドーナドーナのポップ感 + 日本ソシャゲの「出た！」演出
   原則: かわいい = 小振り・短尺・1回バウンス（グリッチやclip-pathは西洋的なので不使用） */

[data-card-enter] {
  --pop-duration: 0.35s;
  --pop-stagger: 120ms;

  animation: card-pop var(--pop-duration) var(--spring) both;
  animation-delay: var(--enter-delay, 0ms);
}

/* fresh + 入場: pop → pulse を直列で再生（animation 競合を回避）
   delay = 入場遅延 + pop 所要時間。pop が終わってから pulse が始まる。 */
[data-card-enter][data-freshness="fresh"] {
  animation:
    card-pop var(--pop-duration) var(--spring) both,
    fresh-pulse 1.5s ease-in-out calc(var(--enter-delay, 0ms) + var(--pop-duration)) 2;
}

@keyframes card-pop {
  0%   { opacity: 0; transform: scale(0.92) translateY(8px); }
  50%  { opacity: 1; transform: scale(1.03) translateY(-2px); }
  75%  { transform: scale(0.998); }
  100% { opacity: 1; transform: none; }
}

/* --- fresh パルス（Hi-Fi Rush 式: パルス = 生きてる感） ---
   < 1時間の記事だけ、ピンクの光が2回パルス。「さっき届いたよ」のシグナル
   入場アニメーションなしの場合はこちらが適用される */
[data-freshness="fresh"]:not([data-card-enter]) {
  animation: fresh-pulse 1.5s ease-in-out 2;
}

@keyframes fresh-pulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(255, 59, 154, 0); }
  50% { box-shadow: 0 0 8px 4px rgba(255, 59, 154, 0.3); }
}

/* --- グリッチエフェクト（stale: 18-24h、消失直前） --- */
.glitch-text {
  animation: glitch 3.5s infinite;
}

@keyframes glitch {
  0%, 100% { text-shadow: none; transform: none; }
  /* 1回目: ガタッ */
  24% { text-shadow: none; transform: none; }
  25% {
    text-shadow: 3px 0 var(--accent-cyan), -3px 0 var(--accent-pink);
    transform: translateX(-3px) skewX(-1deg);
  }
  27% { text-shadow: none; transform: translateX(1px); }
  28% { transform: none; }
  /* 2回目: ビリッ（連打感） */
  30% {
    text-shadow: -2px 0 var(--accent-pink), 2px 0 var(--accent-cyan);
    transform: translateX(2px) skewX(0.5deg);
  }
  32% { text-shadow: none; transform: none; }
}

/* --- ツールチップ入場（ポンッ: card-pop のミニ版） ---
   ドーナドーナ準拠: scale overshoot で「浮き上がる」感
   パネルの出現と同じ spring 曲線、短尺・小振り */
.tooltip-pop {
  animation: tooltip-pop 200ms var(--spring) both;
}

@keyframes tooltip-pop {
  0%   { opacity: 0; scale: 0.9; }
  50%  { opacity: 1; scale: 1.04; }
  100% { opacity: 1; scale: 1; }
}

/* タッチデバイス: ツールチップ非表示（tap = action、tooltip は邪魔） */
@media (hover: none) {
  .tooltip-pop { display: none; }
}

/* ============================================
   浮遊システム（Float System）— River UI のコアビジュアル

   川（背景）の上にすべてが浮いている。
   ホバーで水面から浮き上がり、シアングローが滲む。

   Token Layer:
     --glow-cyan-*     グロー強度（subtle / soft / medium）
     --lift-sm/md       ホバー浮上量
     --scale-sm/md      ホバー拡大率
     --ease-float       浮遊トランジション速度
     --neo-sm/md/lg     ネオブルータリスト影

   Class API:
     float-water[-delay-N]  水面ボブ（上下揺れ）
     float-shadow           ボタン・アイコン（影 + ホバーリフト + グロー）
     float-active           アクティブ状態（neo影 + ホバーリフト + グロー）
     float-shadow-lg        コンテナ（大影、ホバーリフトなし）
     card-float             フィードカード（影 + ホバーリフト + グロー + decay対応）
     click-ripple           押下フィードバック（シアン波紋）

   Usage:
     <button class="click-ripple float-shadow float-water-delay-1">
     <div class="card-float" data-decay="true">
   ============================================ */

/* ── 1. 浮遊アニメーション（水面の上下揺れ） ── */
@keyframes float-water {
  0%, 100% { transform: translateY(0); }
  50%      { transform: translateY(calc(-1 * var(--float-amplitude))); }
}

/* nth-child で周期をずらして非同期に（水面の自然さ） */
.float-water           { animation: float-water 4.0s ease-in-out infinite; }
.float-water-delay-1   { animation: float-water 3.6s ease-in-out infinite; animation-delay: -1.2s; }
.float-water-delay-2   { animation: float-water 4.4s ease-in-out infinite; animation-delay: -2.5s; }
.float-water-delay-3   { animation: float-water 3.8s ease-in-out infinite; animation-delay: -0.7s; }

/* ── 2. 浮遊シャドウ（水面からの浮き + シアン反射光）
   ホバーでリフト + シアングローが強まる = 水面から浮き上がる表現 ── */
.float-shadow {
  box-shadow:
    0 4px 16px -2px rgba(0, 0, 0, 0.35),
    0 0 10px -3px var(--glow-cyan-subtle);
  transition: box-shadow var(--ease-float), translate var(--ease-float), scale var(--ease-float);
}
.float-shadow:hover {
  translate: 0 var(--lift-sm);
  scale: var(--scale-sm);
  box-shadow:
    0 6px 20px -3px rgba(0, 0, 0, 0.4),
    0 0 20px -2px var(--glow-cyan-medium),
    0 0 8px -1px var(--glow-cyan-soft);
}
/* アクティブ状態: ネオブルータリスト影を保持しつつホバーリフト + シアングロー */
.float-active {
  transition: box-shadow var(--ease-float), translate var(--ease-float), scale var(--ease-float);
}
.float-active:hover {
  translate: 0 var(--lift-sm);
  scale: var(--scale-sm);
  box-shadow:
    var(--neo-sm),
    0 0 20px -2px var(--glow-cyan-medium),
    0 0 8px -1px var(--glow-cyan-soft);
}

.float-shadow-lg {
  box-shadow:
    0 8px 24px -4px rgba(0, 0, 0, 0.4),
    0 0 16px -4px var(--glow-cyan-soft);
}

/* ── 3. カード浮遊 + ホバーリフト ──
   card-float は全カード（decay / non-decay）に適用。
   transition を一箇所で統合管理することで、CSS の transition 上書き問題を防ぐ。
   translate/scale は独立プロパティ → card-pop の transform と競合しない。 */

/* 3a. ベースシャドウ（どんな背景でも浮いて見える） */
.card-float {
  box-shadow:
    0 2px 8px -2px rgba(0, 0, 0, 0.3),
    0 4px 16px -4px rgba(0, 0, 0, 0.2);
}

/* 3b. ホバーリフト（前面に浮き上がる + シアン水面グロー） */
.card-float:hover {
  translate: 0 var(--lift-md);
  scale: var(--scale-md);
  box-shadow:
    3px 3px 0 var(--decay-shadow, var(--accent-pink)),
    0 8px 24px -4px rgba(0, 0, 0, 0.45),
    0 4px 12px -2px rgba(0, 0, 0, 0.25),
    0 0 24px -4px var(--glow-cyan-medium),
    0 0 8px -1px var(--glow-cyan-subtle);
}

/* 3c. トランジション統合管理
   non-decay カード（Scoops 等）: 浮遊プロパティのみ */
.card-float {
  transition:
    translate var(--ease-float),
    scale var(--ease-float),
    box-shadow var(--ease-float);
}

/* decay カード: 浮遊 + ドレイン（filter/opacity）を統合
   ゆっくり色を失う */
.card-float[data-decay="true"] {
  transition:
    translate var(--ease-float),
    scale var(--ease-float),
    box-shadow var(--ease-float),
    filter var(--ease-decay-slow),
    opacity var(--ease-decay-slow);
}

/* decay カード ホバー: ドレインは瞬時復帰、浮遊はそのまま */
.card-float[data-decay="true"]:hover,
.card-float[data-decay="true"]:active {
  transition:
    translate var(--ease-float),
    scale var(--ease-float),
    box-shadow var(--ease-float),
    filter var(--ease-decay-fast),
    opacity var(--ease-decay-fast);
}

/* ── 4. クリックリップル（シアンの光輪が広がる + 沈み込み）
   ::before でにじんだ光のリングを描画。 ── */
.click-ripple::before {
  content: '';
  position: absolute;
  inset: -2px;
  border-radius: inherit;
  box-shadow: 0 0 4px 1px rgba(0, 229, 255, 0.4);
  opacity: 0;
  pointer-events: none;
}
.click-ripple:active {
  translate: 0 1px;
}
.click-ripple:active::before {
  animation: click-wave 0.4s ease-out forwards;
}
/* カードリンククリック時のみカード全体を沈み込ませる */
.card-float:has(> .click-ripple:active) {
  translate: 0 1px;
}

@keyframes click-wave {
  0%   { inset: -2px; opacity: 0.6; box-shadow: 0 0 4px 1px rgba(0, 229, 255, 0.4); }
  30%  { opacity: 0.4; }
  100% { inset: -6px; opacity: 0; box-shadow: 0 0 7px 2px rgba(0, 229, 255, 0.3); }
}

/* ── 5. アクセシビリティ: 動き抑制 ── */
@media (prefers-reduced-motion: reduce) {
  /* 浮遊アニメーション */
  .float-water,
  .float-water-delay-1,
  .float-water-delay-2,
  .float-water-delay-3 { animation: none; }

  /* ホバーリフト */
  .float-shadow:hover { translate: none; scale: none; }
  .float-active:hover { translate: none; scale: none; }
  .card-float:hover { translate: none; scale: none; }

  /* クリックリップル */
  .click-ripple:active::before { animation: none; }

  /* エントリーアニメーション */
  .glitch-text,
  [data-freshness="fresh"],
  [data-card-enter] { animation: none !important; }

  /* ツールチップ */
  .tooltip-pop {
    animation: none !important;
    opacity: 1;
  }
}

/* ============================================
   デフォルト背景デコ — 夜の川（River at Night）
   Flum = Flume（水路）。星が川面に映り、光が水面で揺れる。
   ============================================ */

/* ✦ 星空 — 3層のドットグリッドで奥行き（Moiré 効果） */
.river-stars-far {
  background-image:
    radial-gradient(circle, rgba(200, 210, 255, 0.8) 0.5px, transparent 0.5px);
  background-size: 11px 13px;
  opacity: 0.04;
}

.river-stars-mid {
  background-image:
    radial-gradient(circle, rgba(220, 230, 255, 0.9) 0.8px, transparent 0.8px);
  background-size: 29px 31px;
  opacity: 0.06;
}

.river-stars-near {
  background-image:
    radial-gradient(circle, white 1.2px, transparent 1.2px);
  background-size: 67px 71px;
  opacity: 0.07;
}

/* 星空は上半分に集中（川面は下半分） */
.river-sky {
  mask-image: linear-gradient(to bottom, black 30%, transparent 65%);
  -webkit-mask-image: linear-gradient(to bottom, black 30%, transparent 65%);
}

/* ～ 水面の反射 — 星のミラーリング（強ぼかし + 横引き伸ばし）
   blur(6px) + scaleX(3) でドットが横の光筋に滲む = 水面感 */
.river-reflection {
  mask-image: linear-gradient(to top, black 20%, transparent 55%);
  -webkit-mask-image: linear-gradient(to top, black 20%, transparent 55%);
  filter: blur(6px);
  transform: scaleX(3) scaleY(-1);
  transform-origin: center 60%;
  opacity: 1.2;
}

/* ◉ 揺らめき — 水面で光が踊る（呼吸パルス） */
.river-shimmer {
  position: absolute;
  border-radius: 50%;
  animation: shimmer-pulse 4s ease-in-out infinite;
}

.river-shimmer-1 {
  width: 120px; height: 6px;
  bottom: 30%; left: 15%;
  background: radial-gradient(ellipse, var(--accent-pink), transparent 70%);
  opacity: 0.12;
}

.river-shimmer-2 {
  width: 80px; height: 4px;
  bottom: 38%; right: 20%;
  background: radial-gradient(ellipse, var(--accent-cyan), transparent 70%);
  opacity: 0.10;
  animation-delay: -1.5s;
}

.river-shimmer-3 {
  width: 60px; height: 3px;
  bottom: 25%; left: 55%;
  background: radial-gradient(ellipse, white, transparent 70%);
  opacity: 0.08;
  animation-delay: -3s;
}

.river-shimmer-4 {
  width: 100px; height: 5px;
  bottom: 42%; left: 35%;
  background: radial-gradient(ellipse, var(--accent-purple), transparent 70%);
  opacity: 0.09;
  animation-delay: -2.2s;
}

@keyframes shimmer-pulse {
  0%, 100% { transform: scaleX(1); opacity: var(--shimmer-base, 0.1); }
  50% { transform: scaleX(1.4); opacity: calc(var(--shimmer-base, 0.1) * 1.8); }
}

/* ─ 水流ライン — 水平に漂う光の筋（情報の流れ） */
.river-flow {
  position: absolute;
  height: 1px;
  animation: flow-drift 20s linear infinite;
}

.river-flow-1 {
  width: 40%;
  bottom: 35%;
  left: -10%;
  background: linear-gradient(90deg, transparent, var(--accent-cyan), transparent);
  opacity: 0.08;
}

.river-flow-2 {
  width: 30%;
  bottom: 28%;
  left: -5%;
  background: linear-gradient(90deg, transparent, var(--accent-pink), transparent);
  opacity: 0.06;
  animation-delay: -8s;
  animation-duration: 25s;
}

.river-flow-3 {
  width: 50%;
  bottom: 44%;
  left: -15%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
  opacity: 0.05;
  animation-delay: -14s;
  animation-duration: 30s;
}

@keyframes flow-drift {
  from { transform: translateX(0); }
  to { transform: translateX(calc(100vw + 20%)); }
}

/* ◎ 環境光 — 川面に映る街の灯り */
.river-glow {
  position: absolute;
  border-radius: 50%;
  filter: blur(60px);
}

.river-glow-pink {
  width: 300px; height: 200px;
  bottom: 10%; right: 5%;
  background: var(--accent-pink);
  opacity: 0.04;
}

.river-glow-cyan {
  width: 250px; height: 180px;
  top: 15%; left: 5%;
  background: var(--accent-cyan);
  opacity: 0.03;
}

/* ── 水平線 — 空と水面の境界 */
.river-horizon {
  position: absolute;
  top: 55%;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg,
    transparent 5%,
    rgba(200, 210, 255, 0.10) 30%,
    rgba(200, 210, 255, 0.15) 50%,
    rgba(200, 210, 255, 0.10) 70%,
    transparent 95%
  );
}

@media (prefers-reduced-motion: reduce) {
  .river-shimmer,
  .river-flow { animation: none; }
  .river-shimmer { opacity: 0.08; }
}

